function [t,y] = rkf45(f, tspan, y0, h, rTol)
% f is a function of (t,Y)
%%%%%%%%
i = 1;
w(:,1) = y0;
t(1) = tspan(1);
while t(i) < tspan(2)
    %%%%%%%%%
    s1 =f(t(i)           ,w(:,i));
    s2 =f(t(i)+  .25  *h ,w(:,i)+   .25     *h*  s1);
    s3 =f(t(i)+(3/8)  *h ,w(:,i)+(3/32)     *h*  s1+(9/32)      *h* s2);
    s4 =f(t(i)+(12/13)*h ,w(:,i)+(1932/2197)*h*  s1-(7200/2197) *h* s2+(7296/2197) *h*s3);
    s5 =f(t(i)+1      *h ,w(:,i)+(439/216)  *h*  s1-(8)         *h* s2+(3680/513)  *h*s3 - (845/4104) *h*  s4);
    s6 =f(t(i)+(1/2)  *h ,w(:,i)-(8/27)     *h*  s1+(2)         *h* s2-(3544/2565) *h*s3 + (1859/4104)*h*  s4 - (11/40) *h* s5);
    %%%%%%%%%
    w(:,i+1) = w(:,i) + h*((25/216)*s1+(1408/2565)*s3+(2197/4104)*s4-(1/5)*s5);
    z = w(:,i) + h*((16/135)*s1+(6656/12812)*s3+(28561/56430)*s4-(9/50)*s5+(2/55)*s6);
    wMax = max(abs(w(:,i+1)));
    e = max(abs(z-w(:,i+1)));

    %%%%%%%%%
    if e/(wMax) < rTol
        t(i+1) = t(i) + h;
        w(:,i+1) = z;
        i = i+1;

    else
        h = .8*h*(rTol*wMax)^(1/5);

    end
    %%%%%%%%%
end
y = w;
%%%%%%%%%
end